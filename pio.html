<!DOCTYPE html>
<html>
<head>
    <title>Phaser Fixed Size Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #3f3851;
        }
        canvas {
            display: block;
            width: 1536px; /* Imposta larghezza fissa */
            height: 703px; /* Imposta altezza fissa */
        }
    </style>
</head>
<body>
    <script>
        var config = {
            type: Phaser.AUTO,
            width: 1536,
            height: 703,
            physics: {
                default: 'arcade',
                arcade: {
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            scale: {
                mode: Phaser.Scale.NONE // Disattiva il ridimensionamento automatico
            }
        };

        var game = new Phaser.Game(config);

        function preload() {
            this.load.image('mappa1', 'assets/mappa_1.png');
            this.load.image('mappa2', 'assets/mappa_2.png');
            this.load.image('mappa3', 'assets/mappa_3.png');
            this.load.image('mappa4', 'assets/mappa_4.png');
            this.load.spritesheet('gattocamminata', 'assets/gatto_camminata.png', { frameWidth: 1200, frameHeight: 1200 });
            this.load.spritesheet('gattostatico', 'assets/gatto_fermo.png', { frameWidth: 1200, frameHeight: 1200 });
            this.load.spritesheet('gattocorsa', 'assets/gatto_corsa.png', { frameWidth: 1200, frameHeight: 1200 });
            this.load.spritesheet('gattoterra', 'assets/gatto_terra.png', { frameWidth: 1200, frameHeight: 1200 });
            this.load.spritesheet('gattostriscio', 'assets/gatto_striscia.png', { frameWidth: 1200, frameHeight: 1200 });
            this.load.spritesheet('coin', 'assets/coin.png', { frameWidth: 64, frameHeight: 64 });
            this.load.image('dangerPlatform', 'assets/danger_platform.png');
            this.load.image('platform', 'assets/platform.png');
        }

        function create() {
            // Imposta la mappa in modo che riempia il canvas
            this.backgroundImages = [
                this.add.image(0, 0, 'mappa4').setOrigin(0, 0).setDisplaySize(config.width, config.height),
                this.add.image(0, 0, 'mappa3').setOrigin(0, 0).setDisplaySize(config.width, config.height),
                this.add.image(0, 0, 'mappa2').setOrigin(0, 0).setDisplaySize(config.width, config.height),
                this.add.image(0, 0, 'mappa1').setOrigin(0, 0).setDisplaySize(config.width, config.height)
            ];

            this.anims.create({
                key: 'walk',
                frames: this.anims.generateFrameNumbers('gattocamminata', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'idle',
                frames: this.anims.generateFrameNumbers('gattostatico', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'run',
                frames: this.anims.generateFrameNumbers('gattocorsa', { start: 0, end: 3 }),
                frameRate: 12,
                repeat: -1
            });

            this.anims.create({
                key: 'terra',
                frames: this.anims.generateFrameNumbers('gattoterra', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'striscia',
                frames: this.anims.generateFrameNumbers('gattostriscio', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });

            this.player = this.physics.add.sprite(config.width / 2, config.height / 2, 'gattostatico').setOrigin(0.5, 0.5);
            this.player.setDepth(1);
            this.player.setCollideWorldBounds(true);
            this.player.setScale(0.1);
            this.player.body.gravity.y = 800;
            this.player.setSize(550, 500);
            this.player.setOffset(250, 700);

            this.cursors = this.input.keyboard.createCursorKeys();
            this.wasd = {
                up: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),
                left: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),
                down: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),
                right: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),
                shift: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT)
            };
            this.spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

            this.isGrounded = false;

            this.player.anims.play('idle');

            // Piattaforme e pericolo
            this.platforms = [];
            this.createPlatforms();

            this.physics.add.collider(this.player, this.platforms, () => {
                this.isGrounded = true;
            }, null, this);

            this.lives = 3;
            this.livesText = this.add.text(16, 16, 'Lives: 3', {
                fontSize: '32px',
                fill: '#FFFFFF'
            });
            this.livesText.setDepth(10);

            this.coinsCollected = 0;
            this.coinsText = this.add.text(16, 56, 'Coins: 0', {
                fontSize: '24px',
                fill: '#FFFFFF'
            });
            this.coinsText.setDepth(10);

            this.coins = this.physics.add.group({
                defaultKey: 'coin',
                maxSize: 20
            });

            spawnCoins.call(this);
        }

        function createPlatforms() {
            const platformPositions = [
                { x: 770, y: 20, width: 750, height: 45, color: 0x00ff00, image: 'platform' },
                { x: 768, y: 685, width: 150, height: 50, color: 0xff0000, image: null }
            ];

            platformPositions.forEach(pos => {
                let platform;
                if (pos.image) {
                    platform = this.add.image(pos.x, pos.y, pos.image).setOrigin(0.5, 0.5);
                    this.physics.add.existing(platform, true);
                    platform.setDisplaySize(pos.width, pos.height);
                } else {
                    platform = this.add.rectangle(pos.x, pos.y, pos.width, pos.height, pos.color);
                    this.physics.add.existing(platform, true);
                }
                this.platforms.push(platform);
            });
        }

        function update() {
            const walkSpeed = 200;
            const runSpeed = 400;
            let moving = false;

            const isRunning = this.cursors.shift.isDown || this.wasd.shift.isDown;
            const speed = isRunning ? runSpeed : walkSpeed;

            if (this.cursors.left.isDown || this.wasd.left.isDown) {
                this.player.setVelocityX(-speed);
                this.player.setFlipX(true);
                moving = true;
            } else if (this.cursors.right.isDown || this.wasd.right.isDown) {
                this.player.setVelocityX(speed);
                this.player.setFlipX(false);
                moving = true;
            } else {
                this.player.setVelocityX(0);
            }

            if (this.spacebar.isDown && this.isGrounded) {
                this.player.setVelocityY(-400);
                this.isGrounded = false;
            }

            if (this.cursors.down.isDown || this.wasd.down.isDown) {
                this.player.setSize(700, 400);
                this.player.setOffset(300, 400);

                if (moving) {
                    this.player.anims.play('striscia', true);
                } else {
                    this.player.anims.play('terra', true);
                }
            } else {
                this.player.setSize(550, 500);
                this.player.setOffset(250, 700);

                if (moving) {
                    if (isRunning) {
                        this.player.anims.play('run', true);
                    } else {
                        this.player.anims.play('walk', true);
                    }
                } else {
                    this.player.anims.play('idle', true);
                }
            }

            if (this.player.flipX) {
                this.player.setOffset(400, 700);
            } else {
                this.player.setOffset(250, 700);
            }

            if (this.player.y > config.height) {
                loseLife.call(this);
            }
        }

        function spawnCoins() {
            const platformsToSpawnCoins = [
                this.platforms[0]
            ];

            platformsToSpawnCoins.forEach(platform => {
                const coin = this.coins.create(platform.x, platform.y - 32, 'coin');
                coin.setOrigin(0.5, 1);
                coin.setDepth(2);
                coin.setScale(0.5);
            });

            this.physics.add.overlap(this.player, this.coins, collectCoin, null, this);
        }

        function collectCoin(player, coin) {
            coin.setAlpha(0);
            coin.disableBody(true, true);
            this.coinsCollected++;
            this.coinsText.setText('Coins: ' + this.coinsCollected);
        }

        function loseLife() {
            if (this.lives > 0) {
                this.lives--;
                this.livesText.setText('Lives: ' + this.lives);
                this.player.setPosition(config.width / 2, config.height / 2);
            } else {
                this.livesText.setText('Game Over');
                this.player.setVelocityX(0);
                this.player.anims.stop();
            }
        }
    </script>
</body>
</html>
